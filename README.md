# Приложение для анализа транзакций

## Описание проекта

Данный проект предназначен для обработки транзакций, которые находятся в Excel-файле. Приложение, 
генерирует JSON-данные для веб-страниц, формирует отчеты по тратам за последние три месяца, а также предоставляет 
сервис для поиска переводов физическим лицам

## Установка и запуск проекта

Для установки проекта:
1. Клонируйте репозиторий: 
git clone https://github.com/InnaVeselkova/excel-transaction-analytics.git
2. Активируйте виртуальное окружение:
python -m venv venv
source venv/bin/activate   # для Linux/MacOS
venv\Scripts\activate    # для Windows
3. Установите необходимые зависимости:
pip install -r requirements.txt
4. Запустить main.py

## Использование

Основные функции для генерации JSON-ответов реализованы в отдельном модуле views.py.

Данные для анализа и вывода на веб-страницах — это данные с начала месяца, на который выпадает входящая дата, по входящую дату.
Валюты и акции для отображения на веб-страницах задаются в отдельном файле пользовательских настроек 
user_settings.json

В модуле utils реализованы функции для страницы "Главная":

read_excel_file(excel_path: str) -> List[Dict] 

Считывает Excel-файл по указанному пути и преобразует данные в список словарей, где каждый словарь — одна запись (строка) из файла. Возвращает список записей или None в случае ошибки.

get_greeting() -> str 

Возвращает строку приветствия, соответствующую текущему времени суток:

"Доброй ночи" с 00:00 до 05:59,
"Доброе утро" с 06:00 до 11:59,
"Добрый день" с 12:00 до 17:59,
"Добрый вечер" с 18:00 до 23:59. 

get_date_time(data_time: str, date_format: str = "%Y-%m-%d %H:%M:%S") -> List[str] 

Принимает дату и время в виде строки и формат даты. Возвращает период — список из двух строк, представляющих начало месяца даты и саму дату в формате "дд-мм-гггг чч:мм:сс". Используется для задания диапазона дат.

sorted_cards_info(data_list: List[Dict[str, Any]], time_period: List[str]) -> List[Dict] 

Фильтрует и обрабатывает список транзакций по карте за указанный диапазон дат. Для каждой подходящей операции собирает данные:
последние цифры карты,
сумму операции, рассчитанный кэшбек (1% от суммы операции). Возвращает список таких словарей. 

top_transactions(data_list: List[Dict[str, Any]]) -> List[Dict] 

Находит и возвращает 5 транзакций с наибольшей суммой из списка. Каждая транзакция описана словарём с датой, суммой, категорией и описанием.

get_currency(path: str) -> List[Dict] 

На основе настроек пользователя в JSON-файле по пути path получает актуальные курсы валют (конвертация в RUB) через API. Возвращает список словарей с названием валюты и курсом обмена.

get_stocks(path: str) -> List[Dict] 

Читает список акций пользователя из JSON-файла по пути path и запрашивает их текущие курсы через внешний API. Возвращает список словарей с названием акции и её ценой. 

В модуле services реализована функция def filter_personal_transfers(data_list: List[Dict]) -> str, которая фильтрует транзакции, относящиеся к переводам физлицам 

В модуле reports содержится функция, которая возвращает сумму затрат по заданной категории за последние три месяца
    от указанной даты (или текущей, если дата не указана). (def get_expense_report(transactions, category, date=None).
Для ее реализации создан также декоратор для функции-отчета, который записывает в файл результат, который возвращает функция, формирующая отчет. 

Для всех функций написаны тесты, содержащиеся в соответствующих модулях: 

В test_utils: 

Используются pytest, unittest.mock.patch для имитации внешних вызовов.
Тесты покрывают функции для чтения файлов, получения поздравлений, форматирования дат, сортировки транзакций и работы с API.
Есть тесты для проверок ошибок и крайних случаев. В проекте добавлен отчет о покрытии тестами.
